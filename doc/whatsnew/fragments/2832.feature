Checks that contextmanager decorated functions that are generators handle GeneratorExit cleanly.

Closes #2832
